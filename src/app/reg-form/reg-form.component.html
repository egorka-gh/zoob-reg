<div class="container">
  <h1>Регистрация дисконтной карты</h1>

  <form #regForm="ngForm">
    <div class="form-group">
      <label for="card">Номер карты</label>
      <div class="row vertical-align">
        <div class="col-xs-7  ">
          <input type="text" class="form-control" id="card" placeholder="Укажите код карты" [attr.readonly]="(viewState === ViewStates.Init || viewState >= ViewStates.CardApproved)? '': null"
            pattern="^[0-9]+$" [(ngModel)]="model.card" name="card">
        </div>
        <div class="col-xs-4  " *ngIf="(viewState == ViewStates.CardInput || viewState == ViewStates.WrongCard)" >
          <button class="btn btn-primary" (click)="validateCard()">Проверить</button>
        </div>
      </div>
      <div *ngIf="sessionState"><img id=image src="{{clientService.rootUrl}}captcha/{{sessionState.captcha}}.png" alt="Captcha image"></div>
      <div *ngIf="viewState == ViewStates.CardInput" >{{stateMessage}}</div>
      <h4 *ngIf="(viewState == ViewStates.WrongCard || viewState > ViewStates.Complite)" 
        class="alert alert-danger col-xs-7" [innerHTML]="stateMessage">
      </h4>

    </div>

    {{diagnostic}}
    <div [hidden]="viewState != ViewStates.CardApproved">
      <div class="form-group">
        <label for="surname">Фамиля</label>
        <input type="text" class="form-control" id="surname" required placeholder="Фамиля" [(ngModel)]="model.surname" name="surname"
          #surname="ngModel">
        <div *ngIf="name.invalid && (name.dirty || name.touched)" class="alert alert-danger">
          Не указана фамилия
        </div>
      </div>

      <div class="form-group">
        <label for="name">Имя</label>
        <input type="text" class="form-control" id="name" required placeholder="Имя" [(ngModel)]="model.name" name="name" #name="ngModel">
        <div [hidden]="name.valid || name.pristine" class="alert alert-danger">
          Не указано имя
        </div>
      </div>

      <div class="form-group">
        <label for="patronymic">Отчество</label>
        <input type="text" class="form-control" id="patronymic" placeholder="Отчество" [(ngModel)]="model.patronymic" name="patronymic">
      </div>


      <div class="form-group">
        <label for="gender">Пол</label>
        <select class="form-control" id="gender" required [(ngModel)]="model.gender" name="gender">
          <option *ngFor="let gen of genders; let i=index" [value]="i">{{gen}}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input class="form-control" id="email" email [(ngModel)]="model.email" name="email" #email="ngModel">
        <div [hidden]="email.valid || email.pristine" class="alert alert-danger">
          Не верный формат email
        </div>
      </div>

      <div class="form-group">
        <label for="phone">Телефон</label>
        <div class="row vertical-align">
          <div class="col-xs-1 "> <input type="text" class="form-control" [value]="'(+375)'" [attr.readonly]="true" ></div>
          <div class="col-xs-1  ">
            <input type="text" class="form-control" id="phone_code" [(ngModel)]="model.phone_code" name="phone_code" placeholder="Код"
              #phone_code="ngModel" required minlength="2" maxlength="2" pattern="^\s*\d{2}\s*$">
          </div>
          <div class="col-xs-10">
            <input type="text" class="form-control" id="phone" [(ngModel)]="model.phone" name="phone" #phone="ngModel" placeholder="Телефон"
              required minlength="7" maxlength="7" pattern="^\s*\d{7}\s*$">
          </div>
        </div>

        <div [hidden]="phone.valid || phone.pristine" class="alert alert-danger">
          Не верный номер
        </div>
        <div [hidden]="phone_code.valid || phone_code.pristine" class="alert alert-danger">
          Не верный код
        </div>
      </div>

      <div class="form-group">
        <label for="birthday">Дата рождения</label>
        <input type="text" class="form-control" id="birthday" [(ngModel)]="model.birthday" name="birthday" #birthday="ngModel" pattern="^(?:(?:31(\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)\d{2})$|^(?:29(\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)\d{2})$">
        <div [hidden]="birthday.valid || birthday.pristine" class="alert alert-danger">
          Не верный формат даты. Введите дату в формате ДД.ММ.ГГГГ
        </div>
      </div>


      <button type="submit" class="btn btn-success">Зарегистрировать</button>
      <div [innerHTML]="statesMap.get(-1001).web_comment"></div>
    </div>
  </form>
</div>